#!/bin/bash

source $(dirname $0)/lf-config

set +h
export LFS=$LfsTop
export LFS_TGT=$(uname -m)-lfs-linux-gnu
export LC_ALL=POSIX
export FORCE_UNSAFE_CONFIGURE=1
export PATH=$LifoTop/bin:/tools/bin:/bin:/usr/bin

function EnterBuild {
    cd $LfsTop/sources/$Package
    [[ -n $builddir ]] && mkdir --parents $builddir && cd $builddir
}

function ExecPrepare {
    cd $LfsTop/sources/$Package
    [[ "$(type -t prepare)" == "function" ]] && prepare
}

function ExecConfigure {
    EnterBuild
    [[ "$(type -t configure)" == "function" ]] && configure
}

function ExecBuild {
    EnterBuild
    [[ "$(type -t build)" == "function" ]] && build
}

function ExecInstall {
    EnterBuild
    [[ "$(type -t install)" == "function" ]] && install
}

function ExecTrim {
    EnterBuild
    [[ "$(type -t trim)" == "function" ]] && trim
}

Script=$1
[[ -f $Script ]] || Script=$LifoTop/lib/bootstrap/$1

source $Script

Package=$name-$version

ExecPrepare
ExecConfigure
ExecBuild
ExecInstall
ExecTrim
