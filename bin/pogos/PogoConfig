#!/bin/bash -eu (source-only)

[[ -z ${_pogoConfigIncluded:-} ]] || exit
_pogoConfigIncluded=true

if [[ -n ${POGO_CHROOT:-} ]]; then
    InChroot() { return 0; }
else
    InChroot() { return 1; }
fi

NeverInChroot ()
{
    InChroot && Fatal "never ever call this in a chroot"
    true
}

OnlyInChroot ()
{
    InChroot || Fatal "only call this in a chroot"
    true
}

PogoVolume=/Pogo

PogoData=/Data
PogoPrograms=/Programs
PogoSystem=/System

PogoCompile=$PogoData/Compile
PogoSources=$PogoCompile/Sources
PogoBuild=$PogoCompile/Build
PogoStore=$PogoCompile/Store
PogoLfs=$PogoCompile/Lfs
PogoTools=$PogoLfs/tools

PogoVariable=$PogoData/Variable
PogoArchives=$PogoVariable/Archives
PogoDownloads=$PogoVariable/Downloads

PogoIndex=$PogoSystem/Index

Recipes_Home=/LiFo/Recipes

Boots_Collection=LFSboots
Boots_Store="$PogoStore/$Boots_Collection"
Boots_Build="$PogoBuild/$Boots_Collection"

Tools_Collection=LFStools
Tools_Store="$PogoStore/$Tools_Collection"
Tools_Build="$PogoBuild/$Tools_Collection"

Core_Collection=Core
Optional_Collection=Optional

Recipes_Core=Core
Recipes_Collections=(
    "$Boots_Collection"
    "$Tools_Collection"
    "$Core_Collection"
    "$Optional_Collection"
)


Fatal ()
{
    local prefix
    case $0 in
        */pogo) ;;
        *) prefix="pogo " ;;
    esac
        
    echo "${prefix}${0##*/}: $1" 1>&2
    exit 127
}

InfoExit ()
{
    local prefix
    case $0 in
        */pogo) ;;
        *) prefix="pogo " ;;
    esac
        
    echo "${prefix}${0##*/}: $1"

    exit
}

Trace ()
{
    echo "$1" >/dev/console
}

PogoExec ()
{
    [[ -n "$1" ]] || Fatal "no argument given"
    script=/LiFo/bin/pogos/$1
    [[ -e "$script" ]] || Fatal "unknown function '$1'"
    shift
    $script "$@"
}

Import ()
{
    source /LiFo/bin/pogos/$1
}

# export Import function for convenience
declare -F -x Import

declare -a PogoVars
PogoVars=$(declare -p | grep -e 'declare -- Pogo' | cut --characters=12- | sed 's/=.*//')

verbose=--verbose

Import PogoFunctions
Import RecipeFunctions
Import BuildFunctions
